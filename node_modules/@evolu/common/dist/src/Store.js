import { eqStrict } from "./Eq.js";
/**
 * Creates a store with the given initial state. The store encapsulates its
 * state, which can be read with `get` and updated with `set` or `modify`. All
 * changes are broadcast to subscribers.
 *
 * By default, state changes are detected using `===` (shallow equality). You
 * can provide a custom equality function as the second argument.
 */
export const createStore = (initialState, eq = eqStrict) => {
    const listeners = new Set();
    let currentState = initialState;
    const updateState = (newState) => {
        if (eq(newState, currentState))
            return;
        currentState = newState;
        listeners.forEach((listener) => {
            listener();
        });
    };
    return {
        subscribe: (listener) => {
            listeners.add(listener);
            return () => listeners.delete(listener);
        },
        get: () => currentState,
        set: (state) => {
            updateState(state);
        },
        modify: (updater) => {
            updateState(updater(currentState));
        },
    };
};
