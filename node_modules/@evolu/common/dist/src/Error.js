/** Creates a {@link TransferableError} from an unknown error. */
export const createTransferableError = (error) => {
    const convertError = (err) => {
        const transferableError = Object.getOwnPropertyNames(err).reduce((acc, key) => {
            const value = err[key];
            if (key === "cause" && value instanceof Error) {
                // Recursively process the `cause` property
                acc[key] = convertError(value);
            }
            else if (typeof value !== "function") {
                acc[key] = value;
            }
            return acc;
        }, {});
        return transferableError;
    };
    if (error instanceof Error) {
        return {
            type: "TransferableError",
            error: convertError(error),
        };
    }
    try {
        // Clone other values that are transferable
        return {
            type: "TransferableError",
            error: structuredClone(error),
        };
    }
    catch {
        // Fallback for non-transferable or problematic values
        try {
            return {
                type: "TransferableError",
                error: String(error), // Attempt to convert to a string
            };
        }
        catch {
            // Final fallback if even `String(error)` fails
            return {
                type: "TransferableError",
                error: "[Unserializable Object]",
            };
        }
    }
};
